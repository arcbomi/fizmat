<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Check - Mobile</title>
<style>
body {
    margin: 0;
    padding: 0;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    background-color: #002955;
    color: #fff;
}
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
a.home-link {
    display: block;
    margin-bottom: 20px;
    color: #5a9bf6;
    font-weight: bold;
    font-size: 1.5em;
    text-decoration: none;
}
a.home-link:hover {
    text-decoration: underline;
}
table {
    width: 100%;
    max-width: 400px;
    border-collapse: separate;
    border-spacing: 0 10px;
    background-color: #004080;
    border-radius: 15px;
    padding: 10px;
    font-weight: bold;
    text-align: left;
}
caption {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 10px;
    color: #fff;
}
tr:hover {
    color: #ff6666;
}
td {
    padding: 8px 12px;
}
.copy {
    margin-top: 20px;
    font-size: 12px;
    color: #ccc;
    text-align: center;
}
@media (min-width: 500px) {
    table { font-size: 20px; padding: 12px; }
    caption { font-size: 2em; }
    .copy { font-size: 14px; }
}
</style>
</head>
<body>
<div class="container" id="birthday-container">
    <a href="/fizmat/index.html" class="home-link">Home ~ Quakep</a>
</div>

<script>
function decodeBase64Utf8(base64) {
    return decodeURIComponent(escape(atob(base64)));
}

function getTodayDate() {
    let today = new Date();
    let month = (today.getMonth() + 1).toString().padStart(2,'0');
    let day = today.getDate().toString().padStart(2,'0');
    return `${month}-${day}`;
}

async function fetchBirthdays() {
    try {
        const response = await fetch('student-2024-2025.csv');
        if(!response.ok) throw new Error('CSV not found');
        const text = await response.text();
        displayBirthdays(text);
    } catch(e) {
        console.error(e);
    }
}

function displayBirthdays(csvText) {
    const today = getTodayDate();
    const rows = csvText.split('\n').slice(1);
    const container = document.getElementById('birthday-container');

    let birthdayPeople = {};
    rows.forEach(row => {
        const cols = row.split(',');
        if(cols.length >= 2 && cols[0] === today) {
            const name = decodeBase64Utf8(cols[1]);
            const cls = cols[2] ? cols[2] : 'Unknown Class';
            birthdayPeople[name] = cls;
        }
    });

    let html = '<table><caption>Бүгінгі туған күндер</caption>';
    if(Object.keys(birthdayPeople).length > 0) {
        for(let name in birthdayPeople) {
            html += `<tr><td>${name}</td><td>${birthdayPeople[name]}</td></tr>`;
        }
    } else {
        html += `<tr><td colspan="2">Бүгін ешкімнің туған күні жоқ</td></tr>`;
    }
    html += '</table>';
    container.insertAdjacentHTML('beforeend', html);
    container.insertAdjacentHTML('beforeend', `<div class="copy">&copy;2025 FizMat-Quakep</div>`);
}

document.addEventListener("DOMContentLoaded", fetchBirthdays);
</script>
</body>
</html>