<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Check - Mobile</title>
<style>
body {
    margin: 0;
    padding: 0;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    background-color: #002955;
    color: #fff;
}
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
a.home-link {
    display: block;
    margin-bottom: 20px;
    color: #5a9bf6;
    font-weight: bold;
    font-size: 1.5em;
    text-decoration: none;
}
a.home-link:hover {
    text-decoration: underline;
}
table {
    width: 100%;
    max-width: 400px;
    border-collapse: separate;
    border-spacing: 0 10px;
    background-color: #004080;
    border-radius: 15px;
    padding: 10px;
    font-weight: bold;
    text-align: left;
}
caption {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 10px;
    color: #fff;
}
tr:hover {
    color: #ff6666;
}
td {
    padding: 8px 12px;
}
.copy {
    margin-top: 20px;
    font-size: 12px;
    color: #ccc;
    text-align: center;
}
@media (min-width: 500px) {
    table { font-size: 20px; padding: 12px; }
    caption { font-size: 2em; }
    .copy { font-size: 14px; }
}
</style>
</head>
<body>
<div class="container" id="birthday-container">
    <a href="/fizmat/index.html" class="home-link">Home ~ Quakep</a>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    fetchAndDisplayBirthdays("data/student-2024-2025.csv");
});

function fetchAndDisplayBirthdays(csvFile) {
    fetch(csvFile)
        .then(response => response.text())
        .then(data => {
            let birthdayPeople = getBirthdayPeople(data);
            displayBirthdayList(birthdayPeople);
        })
        .catch(error => console.error("Error loading the CSV file:", error));
}

function getBirthdayPeople(data) {
    let rows = data.split("\n").map(row => row.split(","));
    let today = new Date();
    let todayFormatted = ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
    let birthdayPeople = {};

    rows.slice(1).forEach(row => { // Skip header
        let [birthday, name, studentClass] = row;
        if (birthday && birthday.trim() === todayFormatted) {
            birthdayPeople[decodeBase64Utf8(name)] = studentClass;
        }
    });
    return birthdayPeople;
}

function displayBirthdayList(birthdayPeople) {
    let htmlString = '<div class="birthday-list"><table> <caption>Бүгін туған күн</caption>';
    if (Object.keys(birthdayPeople).length > 0) {
        for (let person in birthdayPeople) {
            htmlString += `<tr><td>${person}</td><td>${birthdayPeople[person]}</td></tr>`;
        }
    } else {
        htmlString += '<tr><td colspan="2">Бүгін ешкімнің туған күні жоқ</td></tr>';
    }
    htmlString += '</table></div>';
    document.body.insertAdjacentHTML("afterbegin", htmlString);
}

function decodeBase64Utf8(base64) {
    return decodeURIComponent(escape(atob(base64)));
}
</script>

</body>
</html>